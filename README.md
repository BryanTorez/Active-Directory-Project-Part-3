<h1>SOC Automation (Home Lab) - Part 1</h1>

<p align="center">
<img src="https://snipboard.io/6rb2ue.jpg" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<h2>Description</h2>
<br />
<p align="center">
welcome to part three of five for the series on the active directory project if you haven't seen the previous Parts where we go over how to build out our diagram for this lab and install our virtual machines I highly recommend that you go and watch that first today's objective is to install and configure both sysmon and Splunk onto our Windows Target machine and Windows Server so they can start collecting Telemetry and send logs over to our Splunk server let's get started to begin you want to head over to our virtual box and we want to make sure that our network settings are set to natat network this way our virtual machines can be on the same network and still have internet access to do this we can click on tools and then click on the bullet points you want to make sure that you're selecting Network and over to the tabs there is hostonly network net Network and Cloud networks you want to select Nat Network and click on create at the the bottom I'll go ahead and name this to whatever you want but for me I'll name it as ad project and I'll have the ipv4 prefix as our IP that we put in our diagram if you recall it is 192.168.10.0 sl24 I'll leave enable DHCP checked and I will hit apply perfect so now we created our own natat network called ad project let's head over to our split L server and we want to select settings because now we want to change our network settings over to Nat Network currently if we select Network we do see our adapter attached to natat we can select the drop down and make sure we select Nat Network and as for our name if you have multiple networks make sure you select the one that you just created for me I only have one network called ad project so it automatically selects that for me I'll go ahead and hit okay and we can do this for all of them so under our active directory server I'll select settings head over to network change it from Nat to net Network make sure that it is selecting my network name and hit okay I'll do this for my Windows machine as well and finally my Cali machine net Network hit okay perfect so heading into my Splunk machine if I type in IP space a we'll get an IP address of 192.168 do10 9 and again from our diagram we set the static IP of10 so that means we'll have to set up a static IP on our Splunk server to reflect that and to do that we'll have to type in PSE sudo Nano Etsy SL net plan slash and then you can tab to autocomplete we should only have one file called installer dasc config so this is the correct one that we want under the DHCP setting currently it is set to true so we'll go ahead and remove that and I'll just type in no indicating I do not want any DHCP I'll go ahead and press enter for a new line and then I'll hit tab three times 1 2 3 and I'll type in addresses with a colon hit space and in square brackets we now enter in our IP address so I want it 192.168.10.10 followed by a sl24 if you are not sure what a sl24 is I would encourage you to find some learning material on networking as this is extremely important to know I'll close this off with another square bracket next I'll hit enter and hit three tabs again so 1 2 3 and I'll type in name server with a colon space I'll hit enter again for a new line and this time I'll hit tab five times 1 2 3 4 5 and similar to above I'll type in addresses colon and square bracket and enter in the DNS IP that you want I will use 8.8.8.8 which is Google's DNS hit enter again hit tab three times 1 2 3 and we will type in routes because we want to include a default route press enter for new line and hit tab five times 1 2 3 4 5 I'll add a dash and type two colon default to indicate default route and let's enter in another new line and hit tab six times 1 2 3 4 5 6 and I will type in Via colon 1 192 168 10.1 we want to enter in our Gateway now we can go ahead and save out this configuration by holding control X at the bottom you'll see save modified buffer with a question mark you want to say yes so just type in y and hit enter so I just noticed a mistake that I did for name server we need to add in an s so name servers and now we can go ahead and save that out clear out the screen and type in pseudo net plan apply hit enter now we will get a couple warnings about permissions but since we are in a lab environment it's fine to ignore I'll go ahead and clear out the screen and now I'll type in IPA again and we now should see our IP address as 192168 1010 we can try and ping google.com and we see that there is a connction ction I'll cancel that out by holding contrl C and if you don't have any connectivity or you can't ping google.com do recheck your formatting and if you do get any errors leave it down in the comment section below now that we have connectivity and we have our static IP set we can begin installing Splunk on your host machine so your host not your virtual machine you want to head over to splunk.com and sign up with an account and log in so I'm over at splunk.com and you want to select sign up if you do not have an account once you're signed in head over to products and you want to click on free trials and downloads scroll down to Splunk Enterprise click on get my free trial and you want to make sure you select Linux as your operating system the one that we're interested in is the Deb file so go ahead and select download now and you want to save this in a directory of your choice so for me I will save it under the directory of active directory project the next step is to go back to our Splunk virtual machine and install the guest add-ons for virtual box to do that I'll clear out the screen and then I'll type in pseudo apt get install virtual box and then I'll hit tab to see what kind of options are available we're interested in the guest additions ISO so let's go ahead and type that out guest Das editions now you can use tab for autoc completion and then I'll go ahead and hit enter type y for yes and hit enter and this will take some time depending on your download speeds once you see this screen go ahead and hit enter now our package should be installed we'll go ahead and clear out the screen and on the top you want to click on devices head over to Shared folders and click on shared folder settings and now we want to add a folder by clicking on this icon over here for the folder path we want to select the folder where we put our Splunk installer in so in my case I download loed Splunk under the directory of active directory project so I went ahead and selected that as my folder path for my folder name I'll leave it as default the one that it just populated and as for the options I'll select readon autom Mount and make permanent then I'll hit okay hit okay back onto our Splunk virtual machine I'll go ahead and type in pseudo reboot to reboot our virtual machine we want to log back in with using my dfir as the username and then the password and now we want to add our user to the vbox SF group and to do that we type in pseudo add user and then type in the username so mine is my dfir again yours might be different depending on what you put and then I'll type in vbox SF and I'll hit enter type in the password now you might get the group vbox SF does not exist there might be some additional guest installations that virtual box offers that we did not install yet so we can type in pseudo app get install virtual box hit tab again and we notice that there's guest Das utils let's go ahead and type in guest D utils and hit enter go ahead and clear out the screen and I will reboot one more time go ahead and log back in and now let's try and add our user to that group P sudo add user my dfir vbox SF and now our user is added to that group the next step is to create a new directory called share and to do that I'll type in mkdir and then type in share hit enter type in LS and we do have it is very hard to see but we do have the folder called share now that our directory has been created called share we want to run the following command to mount our shared folder onto our directory called share to do that we type in the command pseudo Mount DT vbox sf- o uid equal 1000 comma gal 1000 space and then we'll type in our shared folder name in my case it was active-directory Das project and I will point it to the share name that we just created now if you forget what your shared folder name is you can go ahead and select device shared folders shared folder settings double click your shared folder and under folder name this is the one that you want to use in my case it is active-directory d project and I'll go ahead and hit enter now if you get an error for whatever reason go ahead and try exiting the session to log out and then log back in because when you add your user into a new group it doesn't take effect until you log out I'll type in ls- LA and we can see that our share is now highlighted so let's go ahead and change directories into that share and I'll type in clear to clear with the screen and type in ls- LA and we get all of the files listed in that directory including our Splunk installer to install Splunk we'll type in pseudo dpkg dasi and then point it over to our Splunk installer hit enter and it should go out and do its thing now once you see the word complete we should be good to go to change into the directory of where Splunk is located onto our server this will be under SL opt SL Splunk so I'll change into that directory and then I'll type in ls- La now you'll notice that all of the user and group belongs to Splunk which is a good thing as it limits the permissions to that user let's change into the user Splunk by typing in pseudo- Splunk bash and now we are acting as the user Splunk change into the directory called bin as the files listed in here are all the binaries that Splunk can use the one that we'll use is the for SLS Splunk and I'll type in start to run the installer we'll get a license and terms agreements we can go ahead and hit q and then type in y to accept as for the administrative username I'll type in my dfir and I'll enter in a password now that the installation is completed let's run one more command to make sure that our Splunk starts up every time our virtual machine reboots so I will type in exit to exit out of the user Splunk I'll change into the directory of Bin and type in PSE sudo SLS spunk enable boot Dart and I will put in the user flag as Splunk this will make it so anytime the virtual machine reboots Splunk will run with the user Splunk now that we have Splunk up and running we want to install Splunk Universal forer and cismon on both our Target machine and our server I will leave the server for you to install to get some hands-on experience it is essentially the same process as the target machine on our Target machine I want to change up a couple things first and foremost I want to change our host name to call it Target and to do that we can search for PC and select properties and you want to click on rename this PC so I'll type in Target DPC for my computer name and hit next and then we'll go ahead and restart the computer once we're back in let's double check our computer Name by typing in PC again and click on properties and we see that our device name is now Target PC the next thing we want to do is search for CMD and click on command prompt we want to take a look at our IP address by doing ip config now if we take a look the IP address is 1 192.168.10.0 if you recall our diagram 10.7 is going to be our Windows Server so I will actually go ahead and change this into a different IP address to do that I'll rightclick the network icon click on open network and internet settings scroll down to change adapter options I'll right click the adapter click on properties and double click the the Internet Protocol version 4 or you can go ahead and just select properties I'll use the following IP address and then I'll set a static IP so let's say 1 192.168.1.100 now my network is a sl24 so that means it is a 255.255.255.0 and the default gateway is 1 192.168.1.1 for the DNS server let's put in 8.8.8.8 for now I'll hit okay and close it out now if we go ahead and type in IP config again we should have an updated IP address of 192.168.1.100 so there won't be any IP conflict happening we can also go ahead and open up a web browser and let's try accessing our Splunk server so our Splunk was on 192.168.10.10 on Port 8000 just as an FYI Splunk listens on Port 8 ,000 so make sure that you specify the port otherwise you will not connect to Splunk and as you can see we can access its login page now let's install Splunk Universal forer by heading over to splunk.com so I'll go to splunk.com and then we'll log in using the account that we just created or if you have an existing account once you're signed in you want to select products head over to free trials and downloads and scroll all the way down until you see un IAL for click on get my free download and you want to make sure that you select the correct operating system and since my target machine is running on a 64bit Windows operating system I will select 64-bit once the download is completed you can go ahead and select downloads and doubleclick the MSI file click on check this box to accept the license agreement make sure that you're selecting the first option which is an on premise Splunk Enterprise instance and hit next for the username I'll just type in admin and I'll leave the Generate random password checked click on next the deployment server we don't have one so we can go ahead and skip that as for the receiving indexer this is going to be our Splunk server so the IP of the Splunk server is 192168101 the default port for Splunk is 9997 when it's receiving events so I'll leave that as 9997 and select next an install we want to start downloading cismon so I'll go ahead and just search up cismon and we'll select the cismon by sis internals scroll down and click on download cismon and I'll go ahead and let that download the cismon configuration that we'll be using is by Olaf so search up Olaf config and that's the one we'll click on his GitHub scroll down and we want to select cismon config.xml click on Raw on the right hand side and then then right click save as and I'll save it under my downloads directory now let's head over to our downloads directory and we should see cison downloaded over here so we'll right click it and click on extract all click extract and what I'll do is I'll click on the file explorer bar and then right click copy and now I'll open up Powershell with administrative privileges so search up Powershell and select run as administrator select yes now the reason why I copied the file path is so now I can just go ahead and type in CD to change directory and paste in the file path and now I'm in that directory so we can type in CIS and hit tab until we hit cis1 64.exe we'll use the - I flag to indicate that I want to specify a configuration file now if you take a look at my directory it is currently set at C users Bob downloads slsy my cismon config is located under my downloads directory so that means I need to go back one directory and to do that we can specify two dots to indicate that hey I want to go back One Directory followed by a backs slash now I can search cismon and hit tab keep hitting tab until you get your cismon config.xml now go ahead and hit enter and this will install cismon for you once you hit agree now that it says cismon 6 4 started and we see an MSI orange icon over here indicating that hey Universal forwarder was successfully installed close it out by clicking on finish I'll close out Powershell and now here is the most important part we need to instruct our Splunk forwarder on what we want to send over to our Splunk server to do this we must configure a file called inputs. com this file is is actually located under the C drive program files Splunk Universal forer Etsy system default and here's the file inputs. com now we can go ahead and rightclick copy but instead I'm actually going to create a new file under the local directory because you do not want to edit the inputs. com file under the default directory that is there just in case you mess anything up you can replace that with the default config so just to make sure that we're all on the same page because this is an important step do not edit the inputs. comom file under the default directory instead we will create a new file under the local directory and we'll name it as inputs. comom now this directory requires administrative privileges as you can see I cannot create anything other than a folder so what I'll do is I'll search up notepad and I will run this as administrator click on yes now I've copied the contents in my inputs. comom file that I'll leave in the description down below where you can go and copy all of that content and paste it into your virtual machine this is instructing our Splunk forwarder to push events related to application security and system as well as syis on over to our Splunk server take note of the index that we're using in my configuration file I have the index pointing to an index name called endpoint this is important to know because whatever events fall under these categories will be sent over to Splunk and placed under the index endpoint if our Splunk server does not have an index named endpoint it will not receive any of these events now if you want to learn more about this I recommend you read Splunk documentation again I'll leave a link down below for you to go ahead and just copy all of this to make sure it works now I will save this notepad file under program files Splunk Universal forer Etsy scroll down to system and put it into the local directory I will call this inputs change the save as type to all files and I'll put an extension as do comp short for configuration click on Save exit the out and now we should see inputs. comom under our local directory do note that anytime you update your inputs. comom file you must restart splunk's Universal forwarder service in order to do that we'll go ahead and just search up services run as administrator and type in s and we want to look for Splunk forwarder service right here now one thing to keep in mind is if you scroll to the right under the column of log on as if you see n n service so we'll go ahead and just double click it and click on log on if you notice that it's using this account ENT service Splunk for it might not be able to collect logs due to some of the permissions so instead you want to select local system account and hit apply it'll say hey the new log on name will not take effect until you stop and restart the service which is what we'll do because we updated our inputs. comom file I can't stress this enough if you update your inputs. comom file you must restart your Splunk forward service otherwise it won't take effect click on okay and now if you look at our column log on as it is now local system that is exactly what we want and just to verify we scroll down just a little bit we do see cismon 64 and it is running let's go ahead and right click Splunk for and you can click on restart over here or you can click on restart right here on the top left now you might get hit with a warning saying that windows cannot stop the Splunk forer service on the local computer that's okay just go ahead and hit okay and just start the service now we have our cismon installed and Splunk Universal forwarder installed along with our updated inputs. comom file now we can finalize our Splunk server configuration let's head over to our Splunk web portal and log in using the credentials that we created during the Splunk is install on our server so my username was my dfir then my password when we're presented with the screen we want to select settings at the top and then head over to indexes now if you recall the inputs. comom file all of the events are being sent over to an index called endpoint this is where we create that index so if we scroll down if you look to the left these are all of the indexes that Splunk has and as you can see we do not see an index index called endpoint so let's go ahead and create that scroll all the way up and click on new index as for the name I'll type in endpoint and click on Save now a new index named endpoint should be created to double check just scroll down and we should see the endpoint index perfect next we need to make sure that we enable our Splunk server to receive the data in order to do that we click on settings click on forwarding and receiving under the re receive data we want to click on configure receiving click on new receiving port and if you recall during our setup we mentioned the default Port of 9997 so let's type in 9997 and hit save if we have everything set up correctly we should start seeing data coming in from our Target machine click on apps on the top left corner and select search and Reporting we'll go ahead and skip this box here skip tour and under the search bar we'll we type in index equals endpoint and take a look at our time frame it has last 24 hours which is perfectly fine and I'll click on the search button we do see some events 2,000 events and if we scroll down just a little bit we see one host and the value is Target PC we also see some sources and Source type our inputs. comom file specifically mentioned the Security application system and syson data and we see that all here you have successfully installed and configured sysmon and Splunk if you do want to learn more about Splunk I do recommend you take a look at their documentation as they are quite detailed now in my sock course we go over slunk and how to build queries to look for evil which is going to be a great experience if you are interested in the course I'll leave a link down below for you to sign up now it is your turn to set set up the server to have both cismon and Splunk installed and configured make sure that you're using the same inputs. comom file as the target machine and you can grab a copy on my GitHub page or in the description down below remember to restart the spunk service after you have your inputs. comom updated on the server let's change Change Server Name the computer name to addc 01 to do that you want to search PC and right click click on properties and then select rename this PC we want to type in ad dc01 click on next and restart once that is completed you can then move on to installing sysmon and Splunk if you have everything set up correctly in Splunk you should see Two Hosts one for the Target PC and the other for ad DC now when you do get this window you just click on continue I hope that everything went smoothly for you and you have learned learn some new things about Splunk if you did come across something that you aren't too sure of or want to learn more about do try and research it now we went over a lot of material and configuration so I am sure that there will be some errors along the way but you and I will get through it together as a reminder links to my sof course and inputs. comom file will be in the description Down Below in part four we will begin to install and configure your active directory if you stay till the end I'll be doing a giveaway and to enter all you really need to do is leave a heart in the comment section down below and that will be it for the video remember to stay curious and do things differently
